<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>FIELD ENFORCEMENT UNIT OPERATIONS WEB MAP</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />

  <!-- Custom Styling -->
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    }

    #map {
      width: 100%;
      height: 100%;
    }

    /* KPI Popup Styling */
    .kpi-popup {
      max-width: 340px;
      font-size: 14px;
    }
    .kpi-title {
      font-size: 18px;
      font-weight: bold;
      color: #d32f2f;
      border-bottom: 2px solid #d32f2f;
      padding-bottom: 6px;
      margin-bottom: 10px;
    }
    .kpi-section {
      background: #f8f9fa;
      padding: 10px;
      border-radius: 6px;
      border-left: 4px solid #1976d2;
      margin: 8px 0;
    }
    .kpi-section-title {
      font-weight: bold;
      color: #1565c0;
      margin-bottom: 6px;
      font-size: 15px;
    }
    .kpi-item {
      margin: 4px 0;
      line-height: 1.5;
    }
    .kpi-label {
      font-weight: bold;
      color: #1976d2;
    }
    .highlight {
      font-weight: bold;
      color: #b71c1c;
      font-size: 15px;
    }
    .status-complete {
      color: #2e7d32;
      font-weight: bold;
      font-size: 15px;
    }


  <!-- Leaflet JS + Omnivore -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet-omnivore@0.3.4/leaflet-omnivore.min.js"></script>

  <script>
    // Initialize map
    const map = L.map('map').setView([-1.3025, 36.78], 14);

    // Base map
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19,
      attribution: 'Â© OpenStreetMap contributors'
    }).addTo(map);

    // === LOAD KML & ADD INTERACTION ===
    const kmlLayer = omnivore.kml('UPPERHILL%20EXTENT.kml')
      .on('ready', function () {
        const layer = this;

        // Style the polygon
        layer.setStyle({
          color: '#d32f2f',
          weight: 4,
          opacity: 1,
          fillColor: '#ff5252',
          fillOpacity: 0.35
        });

        // Fit map to KML bounds
        map.fitBounds(layer.getBounds().pad(0.1));

        // === PERMANENT LABEL ===
        const bounds = layer.getBounds();
        const center = bounds.getCenter();
        L.marker(center, {
          icon: L.divIcon({
            className: 'upperhill-label',
            html: 'UPPERHILL SECTOR',
            iconSize: [180, 40]
          })
        }).addTo(map);

        // === KPI DATA ===
        const kpis = {
          title: "UPPERHILL SECTOR",
          metersInspected: "40,149",
          inspectionCoverage: "100%",
          anomalies: "8,201",
          recoveredUnits: "4,052,829.97 kWh",
          amountRecovered: "KSh 113,479,239.16",
          inspectionStatus: "Complete"
        };

        // === POPUP ON CLICK/TOUCH ===
        layer.on('click', function (e) {
          const popupContent = `
            <div class="kpi-popup">
              <div class="kpi-title">${kpis.title}</div>
              <div class="kpi-section">
                <div class="kpi-section-title">FEU Enforcement KPIs</div>
                <div class="kpi-item"><span class="kpi-label">Meters Inspected:</span> <span class="highlight">${kpis.metersInspected}</span></div>
                <div class="kpi-item"><span class="kpi-label">Inspection Coverage:</span> <span class="highlight">${kpis.inspectionCoverage}</span></div>
                <div class="kpi-item"><span class="kpi-label">Anomalies Detected:</span> <span class="highlight">${kpis.anomalies}</span></div>
                <div class="kpi-item"><span class="kpi-label">Recovered Units:</span> <span class="highlight">${kpis.recoveredUnits}</span></div>
                <div class="kpi-item"><span class="kpi-label">Amount Recovered (KShs):</span> <span class="highlight">${kpis.amountRecovered}</span></div>
                <div class="kpi-item"><span class="kpi-label">Inspection Status:</span> <span class="status-complete">${kpis.inspectionStatus}</span></div>
              </div>
            </div>
          `;

          L.popup({
            maxWidth: 340,
            closeButton: true,
            offset: [0, -10]
          })
          .setLatLng(e.latlng)
          .setContent(popupContent)
          .openOn(map);
        });

        // === HOVER EFFECT (Desktop) ===
        layer.on('mouseover', () => layer.setStyle({ fillOpacity: 0.55, weight: 5 }));
        layer.on('mouseout', () => layer.setStyle({ fillOpacity: 0.35, weight: 4 }));
      })
      .on('error', function () {
        alert('Error loading KML file. Check filename and path.');
      })
      .addTo(map);
  </script>
</body>
</html>



