<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>FEU ENFORCEMENT MAP - UPPERHILL SECTOR</title>
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css">
  <style>
    html, body { margin: 0; padding: 0; height: 100%; font-family: 'Segoe UI', sans-serif; }
    #map { height: 100vh; width: 100%; }
    .kpi-popup { max-width: 380px; }
    .kpi-title { font-size: 19px; font-weight: bold; margin-bottom: 8px; color: #d32f2f; border-bottom: 2px solid #d32f2f; padding-bottom: 5px; }
    .kpi-section { margin: 12px 0; padding: 8px; border-radius: 6px; background: #f0f8ff; border-left: 4px solid #1976d2; }
    .kpi-section-title { font-size: 15px; font-weight: bold; margin-bottom: 6px; color: #1565c0; }
    .kpi-item { margin: 5px 0; font-size: 14px; line-height: 1.4; }
    .kpi-label { font-weight: bold; color: #1976d2; }
    .highlight { font-weight: bold; color: #b71c1c; font-size: 15px; }
    .status-complete { color: #2e7d32; font-weight: bold; font-size: 15px; }
    .upperhill-label { font-weight: bold; font-size: 18px; background: rgba(255,255,255,0.95); border-radius: 8px; padding: 8px 14px; box-shadow: 0 2px 6px rgba(0,0,0,0.3); border: 2px solid #d32f2f; white-space: nowrap; }
  </style>
</head>
<body>
  <div id="map"></div>
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script>
    const map = L.map('map').setView([-1.295, 36.79], 14);
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      attribution: '&copy; OpenStreetMap contributors'
    }).addTo(map);

    // === FINAL 181 COORDINATES (CLEANED & VALIDATED) ===
    const upperhillCoords = [
      [-1.3025015565, 36.7672783716], [-1.3029256441, 36.7673808674], [-1.303863816, 36.76776823],
      [-1.3058697195, 36.7699667026], [-1.3072931002, 36.773358806], [-1.3069606638, 36.776752824],
      [-1.3066177908, 36.7824786815], [-1.3058127974, 36.7853415954], [-1.3066822627, 36.7850768053],
      [-1.3067009667, 36.7849068134], [-1.3068972875, 36.7847571017], [-1.3072862954, 36.784803017],
      [-1.307770131, 36.7845776482], [-1.3082517985, 36.7845220324], [-1.3084304213, 36.7840138496],
      [-1.3096088112, 36.7838662335], [-1.3096623257, 36.7846890987], [-1.3105736862, 36.7850378599],
      [-1.3104989571, 36.7860599025], [-1.3116244174, 36.78673324], [-1.3128743771, 36.7842377287],
      [-1.3136927996, 36.7838882156], [-1.3147695532, 36.7845348716], [-1.3149973092, 36.7853922476],
      [-1.3149416985, 36.7864495786], [-1.3151885145, 36.7883177766], [-1.3145699715, 36.7888853847],
      [-1.3148331937, 36.7895357741], [-1.3155302194, 36.7901172949], [-1.3167358529, 36.7900288072],
      [-1.3177929025, 36.7919266379], [-1.3184013091, 36.7926090551], [-1.3185183789, 36.7929858278],
      [-1.3182883524, 36.7932271046], [-1.3184753378, 36.7936918378], [-1.318881928, 36.7940985679],
      [-1.3201053614, 36.7955252241], [-1.3201965492, 36.79652483], [-1.3204191181, 36.7975019798],
      [-1.3199060455, 36.8004453466], [-1.3199067216, 36.801514665], [-1.3200078503, 36.8029022287],
      [-1.3195509172, 36.8046748593], [-1.3190663793, 36.8062949635], [-1.317413311, 36.807359691],
      [-1.3160241624, 36.8080991266], [-1.3149340887, 36.8095516003], [-1.3146992764, 36.8079318011],
      [-1.3137226799, 36.8071077302], [-1.3131445952, 36.8076293735], [-1.3121490118, 36.8087947707],
      [-1.3121298682, 36.8092288257], [-1.3100951056, 36.8102962758], [-1.3106299587, 36.8116449766],
      [-1.3096880844, 36.8134305451], [-1.2828382475, 36.7876287664], [-1.2822992897, 36.7872623071],
      [-1.2846910007, 36.7841040877], [-1.284148075, 36.7835723772], [-1.2849970596, 36.7825109891],
      [-1.2850216405, 36.7821536135], [-1.2853440554, 36.7817611026], [-1.2858332867, 36.7823185282],
      [-1.2881741821, 36.7803181008], [-1.2877496661, 36.7796271771], [-1.287955279, 36.7796660078],
      [-1.2885435309, 36.7791503602], [-1.289004503, 36.7795502486], [-1.289518691, 36.7787366791],
      [-1.2900539517, 36.7775803665], [-1.290223904, 36.777808946], [-1.2902592326, 36.778279644],
      [-1.2905382105, 36.7783387182], [-1.2905804608, 36.7784570751], [-1.2901956459, 36.7795048383],
      [-1.2911067276, 36.7795972176], [-1.2911011538, 36.7800774308], [-1.2925001224, 36.7801263322],
      [-1.2925057988, 36.7803159786], [-1.2939975668, 36.7805010234], [-1.2939211175, 36.7811973684],
      [-1.2942483283, 36.7813407725], [-1.2942320801, 36.7817418475], [-1.2936101452, 36.7817940446],
      [-1.2935642529, 36.7820374834], [-1.2934976048, 36.7837078695], [-1.2995239706, 36.7846528497],
      [-1.2998777284, 36.7848470803], [-1.2999418031, 36.7861150015], [-1.3012828554, 36.7862280426],
      [-1.3015697276, 36.7810364461], [-1.3022888921, 36.7807493347], [-1.3031066196, 36.7815401803],
      [-1.3036270167, 36.7814965014], [-1.3036512098, 36.780950222], [-1.3031845706, 36.7804615608],
      [-1.3030416938, 36.7797212521], [-1.3022624827, 36.7796287474], [-1.3023023481, 36.7788306424],
      [-1.3016807736, 36.7787523881], [-1.302139167, 36.7742101398], [-1.3032864152, 36.7745570102],
      [-1.3036498618, 36.7750421581], [-1.3048488409, 36.7744817348], [-1.3040068648, 36.7727633282],
      [-1.3035070683, 36.7729294082], [-1.3030469832, 36.7720434188], [-1.3029983958, 36.7715206853],
      [-1.3023632336, 36.7714987325]
    ];

    const upperhill = L.polygon(upperhillCoords, { 
      color: '#d32f2f', weight: 4, opacity: 1, fillColor: '#ff5252', fillOpacity: 0.35 
    }).addTo(map);

    const kpis = { 
      title: "FIELD ENFORCEMENT UNIT OPERATIONS WEB MAP", 
      metersInspected: "40,149", 
      inspectionCoverage: "100%", 
      anomalies: "8,201", 
      recoveredUnits: "4,052,829.97 kWh", 
      amountRecovered: "KSh 113,479,239.16", 
      inspectionStatus: "Complete" 
    };

    upperhill.on('click', function(e) { 
      const popupContent = `<div class="kpi-popup">
        <div class="kpi-title">${kpis.title}</div>
        <div class="kpi-section">
          <div class="kpi-section-title">FEU Enforcement KPIs</div>
          <div class="kpi-item"><span class="kpi-label">Meters Inspected:</span> <span class="highlight">${kpis.metersInspected}</span></div>
          <div class="kpi-item"><span class="kpi-label">Inspection Coverage:</span> <span class="highlight">${kpis.inspectionCoverage}</span></div>
          <div class="kpi-item"><span class="kpi-label">Anomalies Detected:</span> <span class="highlight">${kpis.anomalies}</span></div>
          <div class="kpi-item"><span class="kpi-label">Recovered Units:</span> <span class="highlight">${kpis.recoveredUnits}</span></div>
          <div class="kpi-item"><span class="kpi-label">Amount Recovered (KShs):</span> <span class="highlight">${kpis.amountRecovered}</span></div>
          <div class="kpi-item"><span class="kpi-label">Inspection Status:</span> <span class="status-complete">${kpis.inspectionStatus}</span></div>
        </div>
      </div>`;
      L.popup({ closeButton: true, maxWidth: 380 }).setLatLng(e.latlng).setContent(popupContent).openOn(map); 
    });

    upperhill.on('mouseover', () => upperhill.setStyle({ fillOpacity: 0.55, weight: 5 })); 
    upperhill.on('mouseout', () => upperhill.setStyle({ fillOpacity: 0.35, weight: 4 }));

    upperhill.bindTooltip("UPPERHILL SECTOR", { permanent: true, direction: 'center', className: 'upperhill-label' }).openTooltip();

    map.fitBounds(upperhill.getBounds().pad(0.1));
  </script>
</body>
</html>
